parse_xml stream do
  root RetsResponse do
    element Metadata do
      list :resources, Resource do
        list :classes, Class do
          list :tables, Table
          list :updates, Update do
            list :update_types, UpdateType
          end
          list :column_group_set, ColumnGroupSet
          list :column_group, ColumnGroup do
            list :column_group_control, ColumnGroupControl
            list :column_group_table, ColumnGroupTable
            list :column_group_normalization, ColumnGroupNormalization
          end
        end
        list :object, Object
        list :search_help, SearchHelp
        list :edit_mask, EditMask
        list :update_help, UpdateHelp
        list :lookup, Lookup do
          list :lookup_type, LookupType
        end
        list :validation_external, ValidationExternal do
          list :validation_external_type, ValidationExternalType
        end
        list :validation_expression, ValidationExpression
      end
      list :foreign_key, ForeignKey
      list :filter, Filter do
        list :filter_type, FilterType
      end
    end
  end
end

xml do
  element RetsResponse
end
fn stream -> %RetsResponse{} end

import ExRets.xml
def parse(stream, implementation) do
  xml, stream: stream, implementation do
    element RetsResponse
  end
end



parse_xml stream do
  root "RETS", %RetsResponse{} do
    attribute "ReplyCode", :reply_code
    attribute "ReplyTest", :reply_text
    element "METADATA" do
      element "METADATA-SYSTEM", %Metadata{} do
        attribute "Version", :version
        attribute "Date", :date
        element "SYSTEM" do
          attribute "SystemID", :system_id
          attribute "SystemDescription", :system_description
          attribute "TimeZoneOffset, :time_zone_offset
          attribute "MetadataID", :metadata_id
          element "COMMENTS" do
            text :comments
          end
          element "ResourceVersion" do
            text :resource_version
          end
          element "ResourceDate" do
            text :resource_date
          end
          element_list "Resource", %Resource{} do
            element "ResourceID" do
              text :resource_id
            end
            element "StandardName" do
              text :standard_name
            end
            element "VisibleName" do
              text :visible_name
            end
            element "Description" do
              text :description
            end
            element "KeyField" do
              text :key_field
            end
          end
          element "ForeignKeyVersion" do
            text :foreign_key_version
          end
          element "ForeignKeyDate" do
            text :foreign_key_date
          end
          element "FilterVersion" do
            text :filter_version
          end
          element "FilterDate" do
            text :filter_date
          end
        end
    end
  end
end
